.. _intro:

STON 소개
******************

STON은 인터넷 서비스를 쉽게 확장하기(Easy Scale Out) 위해 개발된 Edge서버이다. 
이전에는 개발과 운영을 따로 규정지었지만 바야흐로 `DevOps <http://en.wikipedia.org/wiki/DevOps>`_ 의 시대이다.
운영없이는 서비스 또한 없다.
하지만 그 동안 운영의 주체인 관리자들의 편안한 주말을 보장해주는 솔루션이 없었다.

STON은 상용솔루션이다.
"상용"의 가장 큰 의미는 장애대처와 재발방지이다.
분명 관리자/개발자들이 책임져야하는 Open Source와는 그 궤를 달리한다.
STON의 개발목표는 국내외 수 많은 서비스를 통해 검증된 신뢰를 모든 고객에게 전파하는 것이다.



.. toctree::
   :maxdepth: 2


Service & Risk
====================================

서비스는 시작되는 순간부터 수많은 위험에 노출된다. 
장애는 언제든 발생할 수 있다. 
점점 많은 사용자와 콘텐츠를 확보할수록 위험과 비용은 예측할 수 없을 만큼 커진다. 
특히나 요즘엔 서비스가 전파되는 시간이 점차 짧아지고 있다. 
이제 누구도 섣불리 미래를 예측할 수 없다.

우리 앞에 놓인 Risk가 무엇인지 정확하게 알아보자.



물리적 한계
---------------------

서비스를 구성하는 S/W는 매우 유연하며 탄력적인 자원이다. 
하지만 H/W 한계를 넘어서는 동작할 수 없다. 
종종 개발자들이 개발 과정에서 S/W에 집중하다 보면 H/W 한계나 운영성을 등한시하는 경우를 본다.
어쩌면 막연히 "좋은 H/W를 구매하면 돼" 또는 "메모리 더 꽂으면 돼" 라는 안일한 생각을 할지도 모른다.

S/W의 범위와 영향력이 넓어지고 서비스 중심으로 시장이 흘러가는 요즘은 더욱 그렇다. 
하지만 서비스는 필연적으로 H/W의 한계에 다다른다.

.. figure:: img/intro_car.png
   :align: center
      
   결국 서버를 사야돼
   
아무리 거대한 서비스라도 결국 물리적인 서버의 집합 위에서 동작한다. 
서버를 구성하는 모든 자원은 한계성을 가지며 서비스는 이런 한계성을 넘어설 수 있도록 설계되어야 한다.

운영할 수 없는 서비스는 마치 달리지 못하는 자동차와 같다. 
서비스 개발 단계에서 Scale-Up 할 자원과 Scale-Out 할 자원을 명확히 구분해야 한다. 
Scale-Out할 수 없다면 절벽을 향해 떠내려가는 땟목과 마찬가지다.



관리자는 어디에?
---------------------

단순계산으로 서버 10대 관리비용이 10이라면 100대의 비용은 100이라고 생각하기 쉽다. 
하지만 대부분 관리자는 최소 1000이상이며 대부분의 경우 추정할 수 없다고 말한다. 
관리기술이 모자란 서비스 관리는 서비스를 헤어나올 수 없는 늪에 빠트린다. 
서버가 "저 아파요~" 라고 말하면 얼마나 좋을까. 
하지만 H/W는 문제가 발생하기 전까지 문제삼지 않는다.
관리자에겐 끊임없는 점검만이 있을 뿐이다. 

신규 서버는 배치하고, 고장 나거나 수명이 다한 서버는 교체해야 한다. 
관리자에 의한 최적화가 이루어지지 않는다면 H/W 가동률은 떨어진다. 
성능을 100% 내지 못한다니 아마도 추가 H/W를 더 구매해야 할지도 모르겠다.

.. figure:: img/intro_money.png
   :align: center
      
   사람은 돈이다
   
기업은 서비스를 더 안정적으로 관리할 수 있는 인력이 필요하다. 
하지만 언제까지 사람으로 메꿔야 할지... 끝이 보이지 않네요. 
그나마 실력이 뛰어난 관리자를 구할 수 있다면 여러분은 행운아입니다.



예고된 장애
---------------------

사람은 언제나 실수하는 동물이니 인재는 제외하자. 
인재의 확률을 줄이고 싶다면 좋은 관리자를 찾아야 한다. 
실수가 없을 것 같은 기계는 어떨까? 확실한 건 기계는 고장난다는 사실뿐이다. 
전력수급 장비에 문제가 생기는 일도 분명히 존재한다. 
이런 경우 UPS(Uninterruptible Power Supply)등의 장애대비용 장비가 있지만, 
절대적인 장애확률을 낮추기 위해 다른 공간(Server Farm)을 선택하는 경우도 흔하다. 
장애 상황까지 고려해 2중/3중 화를 한다면 이제 서버는 곱하기로 늘어난다.

.. figure:: img/intro_dance.png
   :align: center
      
   복제는 축제!
   
서버 속을 들여다보자. 
벼락이라도 맞지 않는 이상 서버의 모든 부품이 동시에 망가지는 경우는 거의 없다. 
서버를 구성하는 부품(CPU, Memory, NIC, Disk) 중 가장 빨리 그리고 빈번히 고장나는 것은 디스크이다.
오죽하면 디스크 이야기에는 "수명"이라는 단어가 빠지지 않다. 

디스크 장애의 가장 치명적인 점은 소중한 콘텐츠가 모두 사라진다는 점이다.
RAID를 사용할 수도 있지만 역시 성능과 돈 사이에서 균형점을 찾아야 한다. 
디스크를 교체했다해도 텅 빈 디스크로는 아무것도 할 수 없다. 
어딘가에서 복사해와야 한다. 
실제 서비스에는 복사할 때 며칠씩 소요되는 경우도 허다하다. 
물론 이 순간에도 콘텐츠는 업로드와 삭제를 반복하고 있다. 
단언컨대 이런 일이 2번 반복되면 그 누구도 모든 서버의 디스크에 같은 데이터가 
존재한다고 말할 수 없다. 
이런 서비스를 고객이 신뢰할 수 있을까?



Storage & Single Point of Pain
---------------------

디스크 동기화는 정말 어려운 문제다. 
NAS(Network Attached Storage)나 SAN(Storage Area Network) 또는 
DAS(Direct Attached Storage)가 흔한 솔루션이다. 
서비스 규모에 맞는 Storage를 구성해 동기화 문제를 해결해도 또 다른 문제가 있다. 

이 "단 하나의" Storage가 죽으면 어떻게 될까? 
눈을 감고 10초만 상상해보자.
달걀을 절대 한 바구니에 담지 말자. 데이터는 이중화도 부족하다.

.. figure:: img/intro_egg.png
   :align: center
      
   Storage가 바구니 가격이었다면...
   
초기 Storage 도입만으로도 동기화 문제가 해결되고 서비스도 안정적일 수 있다. 
하지만 서비스 규모가 커지면 Storage로 부하가 집중되기 시작한다. 
초당 10개의 요청을 처리하던 Storage가 100개를 처리하는 순간 아무도 응답을 받지 못하는 상황이 발생할 것이다. 
그리고 처리되지 못한 요청은 계속 쌓이게 될 것이다. 
클릭하고 라면 끓여먹고 와야할지도 모른다.

.. figure:: img/intro_diskworst.png
   :align: center
      
   이런 그래프는 주식에만 있는 것이 아니다
   
Storage는 대부분 고가이다. 
좋은 걸 사자면 한도 끝도 없다. 
따라서 `만수르 <https://mirror.enha.kr/wiki/%EC%85%B0%EC%9D%B4%ED%81%AC%20%EB%A7%8C%EC%88%98%EB%A5%B4%20%EB%B9%88%20%EC%9E%90%EC%98%88%EB%93%9C%20%EC%95%8C%20%EB%82%98%EC%96%80>`_ 가 아니라면 누구나 경제적인 선택을 할 수밖에 없다. 
분명 Storage는 한계에 다다른다. 

이런 경우 대부분 새로 사야 한다. 
확장성이 뛰어나면서도 안정적이고 속도도 빠른 Storage를 살 수도 있지만, 
가격을 보시면 그런 마음이 사라질 것이다.


Burst와 연쇄부도
---------------------

Burst는 예측할 수 없이 온다. 
가령 유명인이 TV에 나와서 여러분의 서비스를 언급하는 순간 평소 사용자의 10배가 넘는 사용자를 만나게 될 것이다. 

평소 1만 명을 10대의 서버로 처리하는 서비스가 10만 명을 맞이하는 상황을 생각해보자.
이제 서버마다 10배를 처리해야 한다. 
이때 정신력이 약한 1번 서버가 부하를 버티지 못하고 전사했다. 
이제 나머지 9대가 부하를 나누어서 처리해야 한다. 
또 한대가 버티지 못하고 전사했다. 
남은 대수에 상관없이 결국, 모든 서버가 연쇄적으로 무너지게 될 것이다.

.. figure:: img/intro_domino.png
   :align: center
      
   다음은 너다
   
Burst는 눈덩이와 같다. 
버티지 못하면 점점 커져서 공격한다. 

그렇다고 서버를 100대로 늘려야 할까? 
그러면 평소 현재 처리량의 10분의 1만을 처리하며 펑펑 놀게 될 것이다. 
아 도대체 어쩌라고...


진료는 의사에게, 약은 약사에게
---------------------

**"개발은 개발자에게, 운영은 관리자에게"** 
산업이 성장하면서 전문화, 고도화는 당연한 수순이다. 
그래서 개발자는 개발에 집중하고 관리자는 운영에 집중한다. 

하지만 "서비스는 개발자가 낳아서 관리자가 키운다." 라는 말이 무색하게 
개발팀과 운영팀은 대부분 사이가 안좋다. 
출산의 고통은 크지만, 관리자들에겐 끝이 없는 육아가 시작된다. 

문제는 도대체가 이 개~~~~~~~~~발자 분들이 관리자들의 마음을 몰라주며 
독불장군처럼 행동하는 경우가 많다는 것이다.

.. figure:: img/intro_parentfight.png
   :align: center
      
   그만 좀 싸우세요 ㅜ.ㅜ
   
DevOps는 그냥 말뿐인걸까?



Open Source는 누가 책임지나?
----------------------------

여기 길거리에 먹기 좋고 보기 좋은 음식이 있다. 
게다가 공짜다. 
하지만 세균이 가득한 음식일 수도 있다. 
주변 사람들에게 물어보니 배탈이 난 사람도 있고 아닌 사람도 있다고 한다. 
배탈이 안나면 정말 좋겠다. 
나는 괜찮을 수 있지만 다른 사람들도 그럴지 보장할 수 없다. 

Open Source도 비슷하다. 
가져다 쓰는 것은 마음대로지만 아무도 책임지지 않는다. 
빠르게 패치된다고? 그런 기약없는 말 말고 당장 화장실로 휴지를 가져다 줄 사람이 필요하단 말이다!
 
.. figure:: img/intro_idontknow.png
   :align: center
      
   아 몰라~ 몰라~

비극은 개발자가 Open Source웹 사이트를 클릭하면서 시작된다.
그들의 주관심사는 기능이지 운영이나 안정성이 아다. 
그렇게 만들어진 서비스가 1주일마다 어떠한 로그도 없이 죽어버리면 어떨지 상상해보자. 

책임을 Open Source를 선택한 개발자에게 물어봤자 돌아오는 대답은 뻔하다. 
"포럼을 뒤져보았지만, 우리 같은 경우를 찾을 수 없었다." 
이제 뭘 해야 할까?


검증되었다
----------------------------

A사가 서비스를 시작하면서 무수히 많은 시행착오를 겪는다. 
B사도 같은 시행착오를 겪는다. 
A, B사의 사람들이 C사에 가지 않는 이상 C사 역시 마찬가지다. 
이 얼마나 소모적인 반복안가. 
제품이란 이런 낭비적인 기회비용을 줄여줌으로써 가치를 가진다. 
이른바 기회비용을 줄여주는 것이다. 

A사가 사용하는 제품이 큰 장애상황을 견뎠다면 C사 역시 그 제품을 선뜻 선택할 수 있다. 
특히나 엔터프라이즈 서비스에서 "검증되었다." 란 말은 "사귀어 줄께" 와 동급이다.
나랑 안사귀면 아무 의미 없다.

.. figure:: img/intro_guarantee.png
   :align: center
      
   책임지지 못할 짓은 하지 말자
   
여러 서비스를 두루 거치면서 "검증된" 제품이야말로 가장 든든한 동지다. 
먼 길을 떠나는데 "검증되지 않은" 사람들과 같이 가는 것은 언젠가 화를 부른다.


결론
----------------------------

이상의 내용을 쩌는 라임으로 요약하자. :: 

    서버를 사면 돈이 들고, 
    이중화를 하면 곱하기로 돈이 들고, 
    관리자를 교육하려면 돈이 들고, 
    검증되고 고성능 제품을 사려면 돈이 많이 들고
    
    돈, 돈, 돈...
    show me the money
    
그렇다. 결국 돈이다. 
모두가 싸고 좋은 구성을 꿈꾸지만, Risk 앞에서 합리적인 선택을 해야 한다.



Edge서버의 정의
==============================

.. note::
   
   Reverse-Proxy라는 개념에 익숙치 않다면 제이펍에서 출간된  
   `24시간 365일 서버/인프라를 지탱하는 기술 <http://www.yes24.com/24/Goods/3377489>`_ 의 2장을 읽어보자.
   
Cache는 컴퓨터의 탄생부터 존재해온 개념이다.
CPU내부에도 여러 단계의 Cache가 존재하고 OS도 디스크에 저장된 데이터를 메모리에 Caching한다.
단언컨데 Cache는 가장 효율적이며 검증된 방법이다.

인터넷의 도래와 함께 네트워크 상에서 동작하는 Cache가 필요해졌다.
이를 구현한 것을 Topology에 따라 Proxy, Reverse-Proxy로 구분한다.
대표적인 Open Source로 `Squid <http://www.squid-cache.org/>`_ 나 `ATS(Apache Traffic Server) <http://trafficserver.apache.org/>`_ 가 존재한다.
인터넷 환경의 발달과 함께 Proxy는 거의 유명무실해졌다.
주로 Reverse-Proxy를 사용하며 흔히 Web Cache라고 부른다.

.. figure:: img/into_reverseproxy.png
   :align: center
      
   Reverse-Proxy의 개념

`CDN <http://en.wikipedia.org/wiki/Content_delivery_network>`_ 의 보편화와 
모바일시대의 도래는 새로운 운영환경을 요구했다.
특히나 빠른 서비스형태의 변화와 다양한 클라이언트 환경을 각 기업이 Follow-up하는 것은 매우 버거운 일이 아닐 수 없다.

Edge서버의 대표적인 특징은 다음과 같다.

-  원본을 대신하여 서비스를 대중에게 전달한다.

-  대중으로부터 서비스를 보호한다.

-  서비스가 핵심적인 역할만 수행할 수 있도록 보조한다.

가수에게 마이크가 있다면 서비스엔 이제 Edge가 필요하다.
**효과적으로 전달** 하려면 서비스 설계와 확장에 Edge의 개념이 필수적이다.
Edge서버의 주요 특징과 개념에 대해 상세하게 알아보자.



STON 특성과 철학
==============================